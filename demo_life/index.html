<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Story of Your Life</title>
  <style>
    canvas {
      position: absolute;
    }
  </style>
</head>
<body>
<script>
'use strict'

let life = Math.floor(75 * 365.25)
let current = Math.floor(30 * 365.25)
let today = new Date().getDay()

let canvas = document.createElement('canvas')
let ctx = canvas.getContext('2d')
document.body.appendChild(canvas)

window.addEventListener('resize', () => render())

const leftBlockRadius = [99, 0, 0, 99], rightBlockRadius = [0, 99, 99, 0]

function render() {
  const windowSizeX = document.documentElement.clientWidth
  const windowSizeY = window.innerHeight
  const contentSizeX = windowSizeX - 8
  const contentSizeY = windowSizeY - 8

  let blockSize = (life * Math.sqrt((4*life*contentSizeX*contentSizeY + (7*contentSizeY)**2) / (life**2)) + 7 * contentSizeY) / 2 / life
  let countX = Math.floor((contentSizeX / blockSize) / 7) * 7
  let countY = Math.ceil(life / countX)
  let blockSize2 = contentSizeY / countY
  let contentSizeFinalX = countX * blockSize2
  let contentSizeFinalY = countY * blockSize2

  let devicePixelRatio = window.devicePixelRatio
  // no blurry canvas: coderwall.com/p/vmkk6a/how-to-make-the-canvas-not-look-like-crap-on-retina
  canvas.width = contentSizeFinalX * devicePixelRatio // different than canvas.style.width. Btw this clears the canvas as well
  canvas.height = contentSizeFinalY * devicePixelRatio
  canvas.style.width = contentSizeFinalX
  canvas.style.height = contentSizeFinalY
  canvas.style.top = (windowSizeY - contentSizeFinalY) / 2 // center
  canvas.style.left = (windowSizeX - contentSizeFinalX) / 2 // center
  ctx.scale(devicePixelRatio, devicePixelRatio)
  ctx.clearRect(0, 0, contentSizeFinalX, contentSizeFinalY)

  ctx.strokeStyle = 'hsl(120, 73%, 30%)'
  ctx.lineWidth = 0.5

  for (let i = 0; i < life; i++) {
    const todayOffset = i + 10 - today
    if (todayOffset === current) ctx.fillStyle = 'hsl(120, 73%, 40%)' // expensive magic setter. Only touch it when needed...
    else if (todayOffset === current + 1) ctx.fillStyle = 'white'
    else if (i === life - 1) ctx.fillStyle = 'red'
    else if (i === 0) ctx.fillStyle = 'hsl(120, 73%, 75%)'


    const x = i % countX * blockSize2
    const y = Math.floor(i / countX) * blockSize2

    const radius =
      i % 7 === 0 ? leftBlockRadius
      : i % 7 === 6 ? rightBlockRadius
      : 0
    ctx.beginPath()
    ctx.roundRect(x, y, blockSize2, blockSize2, radius)
    ctx.fill()
    ctx.stroke()
  }
}

render()
/*
TODO:
- custom points
*/
</script>
</body>
